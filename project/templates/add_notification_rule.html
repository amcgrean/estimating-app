{% extends "base.html" %}

{% block title %}Add Notification Rule | Estimating App{% endblock %}

{% block content %}
<div class="row justify-content-center animate-fade-in">
    <div class="col-lg-8">
        <div class="card shadow-lg border-0" style="border-radius: 15px; overflow: hidden;">
            <div class="card-header bg-primary text-white py-4"
                style="background: linear-gradient(135deg, #0d6efd 0%, #0dcaf0 100%);">
                <h4 class="mb-0 font-weight-bold text-center">Configure Notification</h4>
                <p class="mb-0 text-center text-white-50 small mt-1">Set up automated email alert rules</p>
            </div>
            <div class="card-body p-5">
                <form method="POST" action="{{ url_for('admin.add_notification_rule') }}">
                    {{ form.hidden_tag() }}

                    <!-- Event Selection -->
                    <div class="form-group mb-4">
                        {{ form.event_type.label(class="font-weight-bold text-uppercase small text-muted
                        tracking-wider") }}
                        {{ form.event_type(class="form-control form-control-lg custom-select input-premium") }}
                    </div>

                    <!-- Recipient Type -->
                    <div class="form-group mb-4">
                        {{ form.recipient_type.label(class="font-weight-bold text-uppercase small text-muted
                        tracking-wider") }}
                        {{ form.recipient_type(class="form-control form-control-lg custom-select input-premium",
                        onchange="toggleRecipientInput()") }}
                    </div>

                    <!-- Recipient Selection (Dynamic) -->
                    <div class="form-group mb-5">
                        <label class="font-weight-bold text-uppercase small text-muted tracking-wider">Select
                            Recipient</label>

                        <!-- Role Select -->
                        <div id="role-select-container">
                            {{ form.recipient_role(class="form-control form-control-lg custom-select input-premium") }}
                            <small class="text-muted mt-2 d-block">Email will be sent to <strong>all active
                                    users</strong> with this role.</small>
                        </div>

                        <!-- User Select -->
                        <div id="user-select-container" style="display: none;">
                            {{ form.recipient_user(class="form-control form-control-lg custom-select input-premium") }}
                            <small class="text-muted mt-2 d-block">Email will be sent to this <strong>specific
                                    user</strong>.</small>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between align-items-center">
                        <a href="{{ url_for('admin.manage_notifications') }}"
                            class="text-muted font-weight-bold">Cancel</a>
                        {{ form.submit(class="btn btn-primary btn-lg px-5 shadow-sm", style="border-radius: 8px;") }}
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    function toggleRecipientInput() {
        // Get value from select (WTForms renders select for recipient_type)
        const typeSelect = document.getElementById('recipient_type');
        const type = typeSelect.value;

        const roleContainer = document.getElementById('role-select-container');
        const userContainer = document.getElementById('user-select-container');

        if (type === 'role') {
            roleContainer.style.display = 'block';
            userContainer.style.display = 'none';
        } else {
            roleContainer.style.display = 'none';
            userContainer.style.display = 'block';
        }
    }

    // Run on load
    document.addEventListener('DOMContentLoaded', function () {
        toggleRecipientInput();
    });
</script>
{% endblock %}