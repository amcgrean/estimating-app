{% extends "base.html" %}

{% block title %}Open Designs | Beisser.io{% endblock %}

{% block styles %}
<style>
    .filter-panel {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        padding: var(--space-lg);
        margin-bottom: var(--space-xl);
        box-shadow: var(--shadow-sm);
    }

    .table-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        overflow: hidden;
        box-shadow: var(--shadow-sm);
    }

    .table thead th {
        background: var(--surface-muted);
        color: var(--text-muted);
        text-transform: uppercase;
        font-size: 0.75rem;
        font-weight: 700;
        letter-spacing: 0.05em;
        padding: 1rem;
    }

    .table td {
        padding: 1rem;
        vertical-align: middle;
        font-size: 0.9rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-end mb-4">
    <div>
        <h2 class="display-5 font-weight-bold" style="font-family: 'Outfit', sans-serif;">Open Designs</h2>
        <p class="text-muted small">Manage architectural layouts and design project specifications.</p>
    </div>
    <a href="{{ url_for('main.add_design', branch_id=current_branch_id) }}" class="btn-premium">
        <i class="fas fa-plus mr-2"></i> Create Design
    </a>
</div>

<div class="filter-panel">
    <form method="GET" action="{{ url_for('main.open_designs') }}" class="form-row align-items-end">
        <div class="col-md-3">
            <label class="font-weight-600 small text-uppercase tracking-wider">Branch</label>
            <select name="branch_id" id="branch_id" class="input-modern">
                <option value="0" {% if current_branch_id==0 %}selected{% endif %}>All Branches</option>
                {% for branch in branches %}
                <option value="{{ branch.branch_id }}" {% if current_branch_id==branch.branch_id %}selected{% endif %}>
                    {{ branch.branch_name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label class="font-weight-600 small text-uppercase tracking-wider">Status</label>
            <select name="status" id="status" class="input-modern">
                {% for status in statuses %}
                <option value="{{ status }}" {% if status==current_status %}selected{% endif %}>{{ status }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <label class="font-weight-600 small text-uppercase tracking-wider">Start Date</label>
            <input type="text" name="start_date" id="start_date" class="input-modern" placeholder="MM/DD/YY">
        </div>
        <div class="col-md-2">
            <label class="font-weight-600 small text-uppercase tracking-wider">End Date</label>
            <input type="text" name="end_date" id="end_date" class="input-modern" placeholder="MM/DD/YY">
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn-premium w-100 justify-content-center">
                <i class="fas fa-filter mr-2"></i> Filter
            </button>
        </div>
    </form>
</div>

<div class="table-card">
    <div class="table-responsive">
        <table class="table mb-0">
            <thead>
                <tr>
                    <th>Plan #</th>
                    <th>Plan Name</th>
                    <th>Customer</th>
                    <th>Address</th>
                    <th>Designer</th>
                    <th>Status</th>
                    <th>Log Date</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
                {% for design in designs %}
                <tr>
                    <td class="font-weight-600">{{ design.planNumber }}</td>
                    <td><a href="{{ url_for('main.manage_design', design_id=design.id) }}"
                            class="font-weight-600 text-primary">{{ design.plan_name }}</a></td>
                    <td><a href="{{ url_for('main.view_customer_bids', customer_id=design.customer_id) }}"
                            class="text-dark">{{ design.customer.name }}</a></td>
                    <td class="small">{{ design.project_address }}</td>
                    <td><span class="badge-premium badge-active"
                            style="background: var(--surface-muted); color: var(--text-main);">{{
                            design.designer.estimatorName if design.designer else 'N/A' }}</span></td>
                    <td>
                        {% if design.status == 'Incomplete' %}
                        <span class="badge-premium badge-incomplete">Incomplete</span>
                        {% elif design.status == 'Complete' %}
                        <span class="badge-premium badge-complete">Complete</span>
                        {% else %}
                        <span class="badge-premium badge-active">{{ design.status }}</span>
                        {% endif %}
                    </td>
                    <td class="text-muted">{{ design.log_date.strftime('%m/%d/%y') }}</td>
                    <td class="text-muted small">{{ design.notes if design.notes else '-' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}