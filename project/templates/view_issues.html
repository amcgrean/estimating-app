{% extends "base.html" %}

{% block title %}View Issues{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>Submitted Issues</h2>
    <table id="issuesTable" class="table table-bordered table-hover">
        <thead class="thead-light">
            <tr>
                <th onclick="sortTable(0)">Issue Type</th>
                <th onclick="sortTable(1)">Created By</th>
                <th onclick="sortTable(2)">Description</th>
                <th onclick="sortTable(3)">Status</th>
                <th onclick="sortTable(4)">Updated By</th>
                <th onclick="sortTable(5)">Updated Date</th>
                <th onclick="sortTable(6)">Notes</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for issue in issues %}
            <tr class="{% if issue.status == 'Completed' %}text-muted completed{% endif %}">
                <td>{{ issue.issue_type }}</td>
                <td>{{ issue.createdby }}</td>
                <td>{{ issue.description }}</td>
                <td>{{ issue.status }}</td>
                <td>{{ issue.updatedby or 'N/A' }}</td>
                <!-- Format updated_date as HH:MM MM/DD/YY -->
                <td>{{ issue.updated_date.strftime('%H:%M %m/%d/%y') if issue.updated_date else 'N/A' }}</td>
                <td>{{ issue.notes or 'N/A' }}</td>
                <td>
                    <!-- Link to update the issue -->
                    <a href="{{ url_for('main.update_issue', issue_id=issue.id) }}" class="btn btn-primary btn-sm">Update</a>

                    <!-- Form for deleting the issue -->
                    <form action="{{ url_for('main.delete_issue', issue_id=issue.id) }}" method="POST" style="display:inline;">
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this issue?');">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <a href="{{ url_for('main.submit_issue') }}" class="btn btn-primary">Submit New Issue</a>
</div>
{% endblock %}

{% block styles %}
<style>
    /* Decrease font size for table */
    table {
        font-size: 0.85rem; /* Reduced font size */
    }

    /* Decrease padding for table cells */
    table th, table td {
        padding: 5px; /* Reduced padding */
    }

    /* Reduce vertical spacing between rows */
    tbody tr {
        line-height: 1.2; /* Slightly reduced line height */
    }

    /* Alternating row colors for table body rows */
    tbody tr:nth-child(even) {
        background-color: #f2f2f2;
    }
    tbody tr:nth-child(odd) {
        background-color: #ffffff;
    }

    /* Hover effect for table rows */
    tbody tr:hover {
        background-color: #ddd;
    }

    /* Cursor pointer for clickable column headers */
    th {
        cursor: pointer;
    }

    /* Style for completed issues - strike-through */
    .completed td {
        text-decoration: line-through;
    }

    /* Text color for completed issues */
    .text-muted {
        color: #6c757d;
    }

    /* Remove unnecessary margin or padding from form controls */
    .form-control, .btn {
        margin-bottom: 0.5rem;
    }
</style>
{% endblock %}
{% block scripts %}
<script>
    // Function to sort table by column index
    function sortTable(columnIndex) {
        const table = document.getElementById("issuesTable");
        const rows = Array.from(table.rows).slice(1);  // Get rows excluding the header
        const isAscending = table.getAttribute("data-sort-dir") === "asc";

        rows.sort((a, b) => {
            const cellA = a.cells[columnIndex].textContent.trim();
            const cellB = b.cells[columnIndex].textContent.trim();

            if (cellA < cellB) {
                return isAscending ? -1 : 1;
            } else if (cellA > cellB) {
                return isAscending ? 1 : -1;
            } else {
                return 0;
            }
        });

        // Append sorted rows back into the table body
        const tbody = table.querySelector("tbody");
        tbody.innerHTML = "";
        rows.forEach(row => tbody.appendChild(row));

        // Toggle sort direction for next click
        table.setAttribute("data-sort-dir", isAscending ? "desc" : "asc");
    }

    // Sort by created date on page load (descending order)
    document.addEventListener("DOMContentLoaded", function() {
        sortTable(0); // Sorting by the first column
    });
</script>
{% endblock %}
